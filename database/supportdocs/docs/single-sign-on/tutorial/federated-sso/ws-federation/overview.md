# Overview
This document covers the WS Federation introduction and its components. It also describes the login flows (Identity Provider Initiated and Service Provider Initiated) that LoginRadius Identity Platform supports.

## WS Federation Introduction

There are several identity protocols that are commonly supported by Identity Providers today like OAuth2, OIDC, SAML and many more likewise WS-Federation is also  a Legacy Protocol that is used by Microsoft Products. 


Web Services Federation (WS-Federation or WS-Fed) is part of the larger WS-Security framework and an extension to the functionality of WS-Trust. The features of WS-Federation can be used directly by SOAP applications and web services. WS-Federation provides mechanisms for brokering of identity, attribute discovery and retrieval, authentication and authorization claims between federation partners, and protecting the privacy of these claims across organizational boundaries.WS-Fed is a protocol that can be used to negotiate the issuance of a token. It works similar to SAML except it has different header input values in URL and it gets response in SAML 1.0.

## Configuring WS Federation

This section explains how you can configure WS Federation with LoginRadius. In order to configure this feature, contact [LoginRadius Support](https://adminconsole.loginradius.com/support/tickets/open-a-new-ticket).

We will be needing  the following information from you so, make sure you are ready with these details while raising the request.

1. **AppName**: WS federation app name.This app name will be used by LoginRadius to identify the request originating source.
2. **Identity Provider Certificate and Key**: Self-signed certificate and key can be generated by one of the following ways:
<br><br>- Using online tools, for example, with Bits and Digest Algorithm 2056, SHA256, respectively.
<br><br>- Using the following [OpenSSL](https://www.openssl.org/source/) commands (currently, LoginRadius is only supporting the PKCS1 private key format):
<br><br> * Generate the private key: ```openssl genrsa -out private.key 2048```
<br><br> * View the private key from the last step: ```vi private.key``` (for Linux OS)
<br><br> * Generate certificate form the private key: ```openssl req -new -x509 -key private.key -out certificate.cert -days 365 -subj /CN=<loginradius-app-name>.hub.loginradius.com```
<br><br> * View certificate from the last step: ```vi certificate.cert``` (for Linux OS)
<br><br>**Note**: To view the ID Provider Certificate key and ID Provider Certificate for Windows OS, go to the folder where you are running the command, and the key will generate in the private.key and certificate.cert file within the same folder.

3. **NameIdFormat,**: The name Id format is supported by the Service Provider. The default value is  "urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified".

4. **Audiences**: This is the App Audience and you can add multiple App audiences for example: "urn:federation:MicrosoftOnline".

5. **WReplyURL**: The 'wreply' value used during login e.g. https://login.microsoftonline.com/login.srf

6. **NameIdentifier**: A name identifier, represented by the <NameIdentifier> element in SAML1 and the <NameID> element in SAML2, is a direct way to name the subject of a SAML assertion. Name identifiers can be anything: an email address, a username, or Uid as required by your application. The default value is Uid for this field.

7. **Field mapping values**: Provide mapping for LoginRadius' fields corresponding to the Service Provider fields and required format. Please see https://www.loginradius.com/docs/api/v2/getting-started/data-points/detailed-data-points/ for the available LoginRadius User Profile fields.

### WS Federation Endpoints

The following are WS federation endpoints for Sign In and Sign Out:

**Sign In:** 

`https://cloud-api.loginradius.com/sso/wsfed/login/<WsFed APP Name>/<LoginRadius API Key>`

**Sign Out:**

`https://cloud-api.loginradius.com/sso/wsfed/logout/<WsFed APP Name>/<LoginRadius API Key>`

Where <WsFed APP Name> is the app name configured for WS federation in the above section and <LoginRadius API key> is API Key for your LoginRadius app. You can find the LoginRadius API key by navigating to Admin Console>Platform Security> Data Access protection> API credentials>Account API keys.

## Query Parameters Appended by the Service Provider

- **wa:** This parameter specifies the action to be performed. By including the action, URIs can be overloaded to perform multiple functions. For sign-in, this string MUST be "wsignin1.0" and for signout, this string MUST be "wsignout1.0". Note that this serves roughly the same purpose as the WS-Addressing Action header for the WS-Trust SOAP RST messages.
- **wctx:** {state} your application's state.
- **wtrealm:** This parameter specifies the Audience set.
- **wreply:** {Callback url} specifies where the response should be sent.


**A WSFed Request looks like this:**

```
<client-request-id>927fe4a4-4eec-4bc7-b4aa-14a4cd846716</client-request-id>
<wa>wsignin1.0</wa>
<wtrealm>urn:federation:MicrosoftOnline</wtrealm>
<wctx>LoginOptions=3&estsredirect=2&estsrequest=rQIIAYWSvYvTYACHm_aungfqnZwfk9zgIEp6b_KmaVoQTNu0uebetLbJ9dKlpEnaJM1HLx9tk8XFwUUQBwdH0eU2RVCc3MQDwdlRbhBxEEFw9PwLXB74Lc_ye9bP0AW6AArgZo4oEJXrFKSKamlUxssqDXGqTABcpUgah0VIQxIQehHA4OL6xvOTe49_iB-E10dbzz_dn1w-wq6ZUTQLKzs7i8Wi4I_HlmYUNN_dcVRPt7zJWwz7jGHfMOxpdtXwcLl3lA1pWIJUiQAEU6aLDAUoooCaSoJsGYhNFKGUXYg1ANpNlOxJponsSYRsFrSl3QSRDWvQFy3FRZRoD6YDSYsGfY5QegCg1DT3-o2pknKR6MpQTLml6KJEtB3rS_ZCm40jk_wHP7BS41f27NgP3OHMD6OnuSdZG2iSbrT4Is95hE5CrtQS5omqDCUOsa2BHLSpoMfAg2l1PKz55R6skoLdxj3K7nSqGsOEypSh5ForatJ7EJRr_MADHaAsDEgMHTWpCvXUbxZNtpNyo46M-FhoSqbD3g0Cw0Wj1v68tpjWTPtwmOzzh6WYZYOEmeg8G_PzmQw0nmWKaVBFZA3BemMuOo1QFOSUnwcTd7DPiAajSDaYpQd8CruSoo0a_ZIULvfHS8oChOUwcrK3O-12D1MnKJsT1WM0QVja3KnRhXJrISgHPSXq9wAeVFvzRDabES33J69y-dMzXd87zp33Z4Zn6duzwB9bjvE1d0k35upsdsfxJ5YXqLoVhwXX-byCfV-5vJbfyF_NbGdubIFcZW1tfSPzb_1ZwZ6tnlYkfTx5eXLlN_viTbz1sLeZOV7dudWOSWYZo6IZ1BRuTHWUA20UetOwG3UJq6Qv3Ftknex2UMzcJivEozz2KJ8_zm_u1ociJ_UkVqyz3To5BD_z2IMzmXdn_9Pll_UtEpAAB2UcwG1AVwhQIejB-3OZvw2</wctx>
<cbcxt></cbcxt>
<username>devapp@loginradius.ml</username>
<mkt>en-US</mkt>
<lc></lc>
```

**A WSFed response will look like this:**

```
<wa>wsignin1.0</wa>
<wctx>LoginOptions=3&estsredirect=2&estsrequest=rQIIAYWSvYvTYACHm_aungfqnZwfk9zgIEp6b_KmaVoQTNu0uebetLbJ9dKlpEnaJM1HLx9tk8XFwUUQBwdH0eU2RVCc3MQDwdlRbhBxEEFw9PwLXB74Lc_ye9bP0AW6AArgZo4oEJXrFKSKamlUxssqDXGqTABcpUgah0VIQxIQehHA4OL6xvOTe49_iB-E10dbzz_dn1w-wq6ZUTQLKzs7i8Wi4I_HlmYUNN_dcVRPt7zJWwz7jGHfMOxpdtXwcLl3lA1pWIJUiQAEU6aLDAUoooCaSoJsGYhNFKGUXYg1ANpNlOxJponsSYRsFrSl3QSRDWvQFy3FRZRoD6YDSYsGfY5QegCg1DT3-o2pknKR6MpQTLml6KJEtB3rS_ZCm40jk_wHP7BS41f27NgP3OHMD6OnuSdZG2iSbrT4Is95hE5CrtQS5omqDCUOsa2BHLSpoMfAg2l1PKz55R6skoLdxj3K7nSqGsOEypSh5ForatJ7EJRr_MADHaAsDEgMHTWpCvXUbxZNtpNyo46M-FhoSqbD3g0Cw0Wj1v68tpjWTPtwmOzzh6WYZYOEmeg8G_PzmQw0nmWKaVBFZA3BemMuOo1QFOSUnwcTd7DPiAajSDaYpQd8CruSoo0a_ZIULvfHS8oChOUwcrK3O-12D1MnKJsT1WM0QVja3KnRhXJrISgHPSXq9wAeVFvzRDabES33J69y-dMzXd87zp33Z4Zn6duzwB9bjvE1d0k35upsdsfxJ5YXqLoVhwXX-byCfV-5vJbfyF_NbGdubIFcZW1tfSPzb_1ZwZ6tnlYkfTx5eXLlN_viTbz1sLeZOV7dudWOSWYZo6IZ1BRuTHWUA20UetOwG3UJq6Qv3Ftknex2UMzcJivEozz2KJ8_zm_u1ociJ_UkVqyz3To5BD_z2IMzmXdn_9Pll_UtEpAAB2UcwG1AVwhQIejB-3OZvw2</wctx>
<wresult>
    <t:RequestSecurityTokenResponse Context="LoginOptions=3&estsredirect=2&estsrequest=rQIIAYWSvYvTYACHm_aungfqnZwfk9zgIEp6b_KmaVoQTNu0uebetLbJ9dKlpEnaJM1HLx9tk8XFwUUQBwdH0eU2RVCc3MQDwdlRbhBxEEFw9PwLXB74Lc_ye9bP0AW6AArgZo4oEJXrFKSKamlUxssqDXGqTABcpUgah0VIQxIQehHA4OL6xvOTe49_iB-E10dbzz_dn1w-wq6ZUTQLKzs7i8Wi4I_HlmYUNN_dcVRPt7zJWwz7jGHfMOxpdtXwcLl3lA1pWIJUiQAEU6aLDAUoooCaSoJsGYhNFKGUXYg1ANpNlOxJponsSYRsFrSl3QSRDWvQFy3FRZRoD6YDSYsGfY5QegCg1DT3-o2pknKR6MpQTLml6KJEtB3rS_ZCm40jk_wHP7BS41f27NgP3OHMD6OnuSdZG2iSbrT4Is95hE5CrtQS5omqDCUOsa2BHLSpoMfAg2l1PKz55R6skoLdxj3K7nSqGsOEypSh5ForatJ7EJRr_MADHaAsDEgMHTWpCvXUbxZNtpNyo46M-FhoSqbD3g0Cw0Wj1v68tpjWTPtwmOzzh6WYZYOEmeg8G_PzmQw0nmWKaVBFZA3BemMuOo1QFOSUnwcTd7DPiAajSDaYpQd8CruSoo0a_ZIULvfHS8oChOUwcrK3O-12D1MnKJsT1WM0QVja3KnRhXJrISgHPSXq9wAeVFvzRDabES33J69y-dMzXd87zp33Z4Zn6duzwB9bjvE1d0k35upsdsfxJ5YXqLoVhwXX-byCfV-5vJbfyF_NbGdubIFcZW1tfSPzb_1ZwZ6tnlYkfTx5eXLlN_viTbz1sLeZOV7dudWOSWYZo6IZ1BRuTHWUA20UetOwG3UJq6Qv3Ftknex2UMzcJivEozz2KJ8_zm_u1ociJ_UkVqyz3To5BD_z2IMzmXdn_9Pll_UtEpAAB2UcwG1AVwhQIejB-3OZvw2" xmlns:t="http://schemas.xmlsoap.org/ws/2005/02/trust">
        <t:RequestedSecurityToken>
            <saml:Assertion xmlns:saml="urn:oasis:names:tc:SAML:1.0:assertion" MajorVersion="1" MinorVersion="1" AssertionID="_a37d9d8a-2c1e-4b1b-a842-25d89b4a56f5" IssueInstant="2020-09-03T06:12:48Z" Issuer="https://dev-cloudapp.devhub.lrinternal.com/">
                <saml:Conditions NotBefore="2020-09-03T06:12:48Z" NotOnOrAfter="2020-09-03T06:22:48Z">
                    <saml:AudienceRestrictionCondition>
                        <saml:Audience>urn:federation:MicrosoftOnline</saml:Audience>
                    </saml:AudienceRestrictionCondition>
                </saml:Conditions>
                <saml:AttributeStatement>
                    <saml:Subject>
                        <saml:NameIdentifier Format="urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified">c50c94f07493428ea9b3444eae667082</saml:NameIdentifier>
                        <saml:SubjectConfirmation>
                            <saml:ConfirmationMethod>urn:oasis:names:tc:SAML:1.0:cm:bearer</saml:ConfirmationMethod>
                        </saml:SubjectConfirmation>
                    </saml:Subject>
                    <saml:Attribute AttributeNamespace="http://schemas.xmlsoap.org/ws/2005/05/identity/claims" AttributeName="upn">
                        <saml:AttributeValue>devapp@loginradius.ml</saml:AttributeValue>
                    </saml:Attribute>
                    <saml:Attribute AttributeNamespace="http://schemas.xmlsoap.org/ws/2005/05/identity/claims" AttributeName="emailaddress">
                        <saml:AttributeValue>devapp@loginradius.ml</saml:AttributeValue>
                    </saml:Attribute>
                </saml:AttributeStatement>
                <saml:AuthenticationStatement AuthenticationMethod="urn:oasis:names:tc:SAML:1.0:am:password" AuthenticationInstant="2020-09-03T06:22:48Z">
                    <saml:Subject>
                        <saml:NameIdentifier Format="urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified">c50c94f07493428ea9b3444eae667082</saml:NameIdentifier>
                        <saml:SubjectConfirmation>
                            <saml:ConfirmationMethod>urn:oasis:names:tc:SAML:1.0:cm:bearer</saml:ConfirmationMethod>
                        </saml:SubjectConfirmation>
                    </saml:Subject>
                </saml:AuthenticationStatement>
                <Signature xmlns="http://www.w3.org/2000/09/xmldsig#">
                    <SignedInfo xmlns="http://www.w3.org/2000/09/xmldsig#">
                        <CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/>
                        <SignatureMethod Algorithm="http://www.w3.org/2001/04/xmldsig-more#rsa-sha256"/>
                        <Reference URI="#_a37d9d8a-2c1e-4b1b-a842-25d89b4a56f5">
                            <Transforms>
                                <Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/>
                                <Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/>
                            </Transforms>
                            <DigestMethod Algorithm="http://www.w3.org/2001/04/xmlenc#sha256"/>
                            <DigestValue>Xe9VVfbNjpL8vsBXIRUqf1WvuXPXokqenDC9BusbIbM=</DigestValue>
                        </Reference>
                    </SignedInfo>
                    <SignatureValue>aJo1HzhwWNT+ivppdhMc3LLEHKgV/sMVbA6pqzO19WNUZOgUFUYfXs+inLsfZiobvyJC8hqlqQWMbmeAGW8LUzoj1ixmdEJ0r8j2/psMtfrVahNL6BZZUljS8cASpqykKpEuzdiLwkKMs66fxTi3rEfTs/+6U9iaQxy8AsooYUPNrGzc4N1hxof+b0o17wWGHuovXsp/ldM/8dTfDKyQ6jWd6Mzp4kzjeBwe/TUHppxmDYsqttvU/KzBEhk9Lb23oNmzHkmxOABRgfb/eubfSyvo6i0CFKqAQdkoWIlKiEXm15XZDxxhgDI/RFXR0IdwujoiEovB80uhykMYcPjpkQ==</SignatureValue>
                    <KeyInfo>
                        <X509Data>
                            <X509Certificate>MIIDLDCCAhSgAwIBAgIJALwtdp+dP0F0MA0GCSqGSIb3DQEBCwUAMCsxKTAnBgNVBAMMIGRldi1tYXlhbmsuZGV2aHViLmxyaW50ZXJuYWwuY29tMB4XDTE5MDkyNTAyMDI0MFoXDTI5MDkyMjAyMDI0MFowKzEpMCcGA1UEAwwgZGV2LW1heWFuay5kZXZodWIubHJpbnRlcm5hbC5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDoUUjeJP8D4vA6gEJdHaFloZQ50CWyEVn2LW9M+TGmlMUWPBOavuuEP5rUlPoe4ZyyJFeQiPbmbpZILBTd8vo4HPnTso4DYRaiiXgtul7F/1W4MTw17yoe5VLJXIh0piJJSwQbaZLzJ4smUCSaCF+iklWmYBSQFQhHnPSnRm3x+e+MVAxmguz5CkkRh0x/UrBd0Si0CaMYLc0ZyhTSJciVcYWGzzzc4zXVP+oAxVBxNbELtHNpAtvkWWCAJ6fGJKDWecvXz4FWt8AkOLztG+g4JNOTY9u1K7N7XyO+Q8pfK5SA96pnMqeZEW8tH84XcTWHvzk4JvGtmhRG8+uWmpDVAgMBAAGjUzBRMB0GA1UdDgQWBBSWUsrIcxlPlw5tO2cm+GUhKSgG8zAfBgNVHSMEGDAWgBSWUsrIcxlPlw5tO2cm+GUhKSgG8zAPBgNVHRMBAf8EBTADAQH/MA0GCSqGSIb3DQEBCwUAA4IBAQDHyfSbgbVz3tBYOYnADBKW+1gIAolPsEWAIz799gwqZcNm0CQVtnsCqw5Vx8fG5Tvf7SEYBvSYJNMlPpATELtIAT8zws7AMogKnTM1kPYiUlKLY4usAmKuCdugFp1FjTR79HGp0XpwFHStzAxLk7OmkSrg/NawhVjolb307SMhEptF/5cbsA96OMJBH5agTFPEkaXYaGhz5uy3u3h9kI6BHq0D7Rq1uOQ0JqN5PBsOaYZJ3sdtYwd+rfsskT0hzwy0fP3MtjKqE91tQtUDv351FeCwQUUSX90te5MSKnXdM12SrYvg44fUbCUGp5iJmLkrYuOgfhbVzD3PHzV9lYRr</X509Certificate>
                        </X509Data>
                    </KeyInfo>
                </Signature>
            </saml:Assertion>
        </t:RequestedSecurityToken>
    </t:RequestSecurityTokenResponse>
</wresult>
```